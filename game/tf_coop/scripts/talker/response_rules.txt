// This is the base rule script file for the AI response system for Expressive AI's who speak based on certain "Concepts"
// You can think of a concept as a high level state that the code is trying to convey, such as say hello, or say you're mad, etc.
//
// The format of this file is that there are five main types of commands:
// 1) #include "filename"	// This just causes the included scriptfile to be parsed and added to the database
// 2) enumeration:  this declares an enumerated type so that comparisons can be matched against the string versions of the type
// 3) response:  this specifies a response to issue.  A response consists of a weighted set of options and can recursively reference
//    other responses by name
// 4) criterion:  This is a match condition
// 5) rule:  a rule consists of one or more criteria and a response
//
// In general, the system is presented with a criteria set, which is a set of key value pairs generated by the game code and
//  various entity I/O and keyfields.  For instance, the following criteria set was created in a map with a train terminal 
// "speaker" entity wishing to fire random station announcements
//               concept = 'train_speaker' (weight 5.000000)		; the high level concept for the search request
//                   map = 'terminal_pa'							; the name of the map
//             classname = 'speaker'								; the classname and name of the "speaking" entity
//                  name = 'terminal_pa'
//                health = '10'										; the absolute health of the speaking entity
//            healthfrac = '0.000'									; the health fraction (health/maxhealth) of the speaking entity
//          playerhealth = '100'									; similar data related to the current player:
//      playerhealthfrac = '1.000'
//          playerweapon = 'none'									; the name of the weapon the player is carrying
//        playeractivity = 'ACT_WALK'								; animating activity of the player
//           playerspeed = '0.000'									; how fast the player is moving
//
// Based on such a criteria set, the system checks each rule against the set.  To do this, each criterion of the rule is
//  given a numeric score as follows:
// score = 0 if criteria doesn't match or, criterion weight * keyvaliue weight if it does match
// The final score for a rule is the sum of all of the scores of its criteria.  The best rule is the one with the highest
//  score.  Once a best rule is selected, then a response is looked up based on the response definitions and the engine is
//  asked to dispatch that response.
//
// The specific syntax for the various keywords is as follows:
//
// ENUMERATIONS:
//
// enumeration <enumerationname>
// { 
//		"key1" "value1"
//		"key2" "value2"
//		...etc.
//	}
//	The code and criteria refer to enumerations with square brackets and a double colon separator, e.g.:
//  [enumerationname::key1]
//
//
// RESPONSES:
//
// Single line: 
// response <responsegroupname> [nodelay | defaultdelay | delay interval ] [speakonce] [noscene] [odds nnn] [respeakdelay interval] [soundelvel "SNDLVL_xxx"] responsetype parameters
// Multiple lines
// response <responsegroupname>
// {
//		[permitrepeats]   ; optional parameter, by default we visit all responses in group before repeating any
//		[sequential]	  ; optional parameter, by default we randomly choose responses, but with this we walk through the list starting at the first and going to the last
//		[norepeat]		  ; Once we've run through all of the entries, disable the response group
//		responsetype1 parameters1 [nodelay | defaultdelay | delay interval ] [speakonce] [odds nnn] [respeakdelay interval] [soundelvel "SNDLVL_xxx"] [displayfirst] [ displaylast ] weight nnn
//		responsetype2 parameters2 [nodelay | defaultdelay | delay interval ] [speakonce] [odds nnn] [respeakdelay interval] [soundelvel "SNDLVL_xxx"] [displayfirst] [ displaylast ] weight nnn
//		etc.
// }
// Where: 
//   interval = "startnumber,endnumber" or "number" (e.g., "2.8,3.2" or "3.2")
//   responsetype =:
//     speak		; it's an entry in sounds.txt
//     sentence		; it's a sentence name from sentences.txt
//     scene		; it's a .vcd file
//     response		; it's a reference to another response group by name
//     print      ; print the text in developer 2 (for placeholder responses)
//   nodelay = an additional delay of 0 after speaking
//   defaultdelay = an additional delay of 2.8 to 3.2 seconds after speaking
//   delay interval = an additional delay based on a random sample from the interval after speaking
//   predelay interval = delays the speech for the time interval. NOTE: Only works on scenes (i.e. no sentences/speak/print)
//   speakonce = don't use this response more than one time (default off)
//	 noscene = For an NPC, play the sound immediately using EmitSound, don't play it through the scene system. Good for playing sounds on dying or dead NPCs.
//   odds = if this response is selected, if odds < 100, then there is a chance that nothing will be said (default 100)
//	 respeakdelay = don't use this response again for at least this long (default 0)
//   soundlevel = use this soundlevel for the speak/sentence (default SNDLVL_TALKING)
//   weight = if there are multiple responses, this is a selection weighting so that certain responses are favored over others in the group (default 1)
//   displayfirst/displaylast : this should be the first/last item selected (ignores weight)
//
// CRITERIA:
//
// criterion <criterionname> <matchkey> <matchvalue> weight nnn required
// Where:
//  matchkey matches one of the criteria in the set as shown above
//  matchvalue is a string or number value or a range, the following are all valid:
//  "0"						; numeric match to value 0
//  "1"						; numeric match to value 1
//   "weapon_smg1"			; string match to weapon_smg1 string
//   "[npcstate::idle]"		; match enumeration by looking up numeric value
//   ">0"					; match if greater than zero
//   ">10,<=50"				; match if greater than ten and less than or equal to 50
//   ">0,<[npcstate::alert]"	; match if greater than zer and les then value of enumeration for alert
//   "!=0"					; match if not equal to zero
// weight = floating point weighting for score assuming criteria match (default value 1.0)
// required:  if a rule has one or more criteria with the required flag set, then if any such criteria
//  fail, the entire rule receives a score of zero
//
// RULE:
//
// rule <rulename>
// {
//    criteria name1 [name2 name3 etc.]
//    response responsegroupname [responsegroupname2 etc.]
//    [matchonce]					; optional parameter
//	  [ <matchkey > <matchvalue> weight nnn required ]
// }
// Where:
// criteria just lies one more more criterion names from above and response list one or more of the response
// names from above (usually just one)
// matchonce (off by default): means that the rule is deactivated after the first time it is matched
// Note that additional "unnamed" criteria can be specified inline in the rule using the same syntax
// as for defining a criterion, except for the criterion keyword and the criterion name keys
//
// Interaction with entity I/O system
// CBaseEntity contains an inputfunc called "DispatchResponse" which accepts a string which is a concept name
//  Thus, a game entity can fire this input on another entity with a concept string and a criteria set will
//  be generated and searched against the entities current response system rule set.
// Right now only the speaker entity and NPC_Talker derived NPCs have any response rules loaded
// In addition, map placed entities have up to three "context" keypairs that can be specified.
// They take the form:  "key:value" (key, single colon separator, value)
// When an entity with any such context keypairs is asked to dispatch a response, the keypairs are added to the
//  criteria set passed to the rule system.  Thus, map placed entities and triggers can specify their
//  own context keypairs and these can be hooked up to response rules to do map-specific and appropriate
//  responses
// In addition, entity I/O can be used to add, remove and clear any such context keypairs via the
//   AddContext, RemoveContext, and ClearContext input functions.
// AddContext takes a keypair of the "key:value" format, while RemoveContext take just the "key"
// ClearContext removes all context keypairs
// The game .dll code can enumerate context keypairs and change them via code based methods
//
// The player and the world have their context added with the string player or world as a prefix, e.g.:
//  "playerkey:value" or "worldkey:value" to differentiate world/player context from the context of the
//  responding entity.

// Base script
enumeration "NPCState"
{
	"None"		"0"
	"Idle"		"1"
	"Alert"		"2"
	"Combat"	"3"
	"Scripted"	"4"
	"PlayDead"	"5"
	"Dead"		"6"
}

criterion "ConceptPlayerTaunt" "Concept" "TLK_PLAYER_TAUNT" "required"
criterion "ConceptPlayerThanks" "Concept" "TLK_PLAYER_THANKS" "required"
criterion "ConceptPlayerMedic" "Concept" "TLK_PLAYER_MEDIC" required
criterion "ConceptPlayerHelp" "Concept" "TLK_PLAYER_HELP" required
criterion "ConceptPlayerGo" "Concept"  "TLK_PLAYER_GO" required
criterion "ConceptPlayerMoveUp" "Concept" "TLK_PLAYER_MOVEUP" required
criterion "ConceptPlayerLeft" "Concept" "TLK_PLAYER_LEFT" required
criterion "ConceptPlayerRight" "Concept" "TLK_PLAYER_RIGHT" required
criterion "ConceptPlayerYes" "Concept" "TLK_PLAYER_YES" required
criterion "ConceptPlayerNo" "Concept" "TLK_PLAYER_NO" required
criterion "ConceptPlayerIncoming" "Concept" "TLK_PLAYER_INCOMING" required
criterion "ConceptPlayerCloakedSpy" "Concept" "TLK_PLAYER_CLOAKEDSPY" required
criterion "ConceptPlayerSentryAhead" "Concept" "TLK_PLAYER_SENTRYAHEAD" required
criterion "ConceptPlayerTeleporterHere" "Concept" "TLK_PLAYER_TELEPORTERHERE" required
criterion "ConceptPlayerDispenserHere" "Concept" "TLK_PLAYER_DISPENSERHERE" required
criterion "ConceptPlayerSentryHere" "Concept" "TLK_PLAYER_SENTRYHERE" required
criterion "ConceptPlayerActivateCharge" "Concept" "TLK_PLAYER_ACTIVATECHARGE" required
criterion "ConceptPlayerChargeReady" "Concept" "TLK_PLAYER_CHARGEREADY" required
criterion "ConceptPlayerTaunts" "Concept" "TLK_PLAYER_TAUNTS" required
criterion "ConceptPlayerBattleCry" "Concept" "TLK_PLAYER_BATTLECRY" required
criterion "ConceptPlayerCheers" "Concept" "TLK_PLAYER_CHEERS" required
criterion "ConceptPlayerJeers" "Concept" "TLK_PLAYER_JEERS" required
criterion "ConceptPlayerPositive" "Concept" "TLK_PLAYER_POSITIVE" required
criterion "ConceptPlayerNegative" "Concept" "TLK_PLAYER_NEGATIVE" required
criterion "ConceptPlayerNiceShot" "Concept" "TLK_PLAYER_NICESHOT" required
criterion "ConceptPlayerGoodJob" "Concept" "TLK_PLAYER_GOODJOB" required
criterion "ConceptSpySapping" "Concept" "TLK_SPY_SAPPER" required
criterion "ConceptPain" "Concept" "TLK_PLAYER_PAIN" required
criterion "ConceptAttackerPain" "Concept" "TLK_PLAYER_ATTACKER_PAIN" required
criterion "ConceptFire" "Concept" "TLK_ONFIRE" required
criterion "ConceptCapBlocked" "Concept" "TLK_CAPTURE_BLOCKED" required
criterion "ConceptMedicChargeDeployed" "Concept" "TLK_MEDIC_CHARGEDEPLOYED" required
criterion "ConceptMedicChargeStopped" "Concept" "TLK_HEALTARGET_STOPPEDHEALING" required 


//Auto fire concepts
criterion "ConceptPlayerCapturedPoint" "Concept" "TLK_CAPTURED_POINT" required
criterion "ConceptPlayerRoundStart" "Concept" "TLK_ROUND_START" required
criterion "ConceptPlayerSuddenDeathStart" "Concept" "TLK_SUDDENDEATH_START" required
criterion "ConceptPlayerStalemate" "Concept" "TLK_STALEMATE" required
criterion "ConceptPlayerBuildingObject" "Concept" "TLK_BUILDING_OBJECT" required
criterion "ConceptPlayerDetonatedObject" "Concept" "TLK_DETONATED_OBJECT" required
criterion "ConceptLostObject" "Concept" "TLK_LOST_OBJECT" required
criterion "ConceptKilledObject" "Concept" "TLK_KILLED_OBJECT" required
criterion "ConceptMedicChargeReady" "Concept" "TLK_MEDIC_CHARGEREADY" required
criterion "ConceptTeleported" "Concept" "TLK_TELEPORTED" required
criterion "ConceptPlayerDead" "Concept" "TLK_DEAD" required

criterion "ConceptPlayerGrabbedIntelligence" "Concept" "TLK_FLAGPICKUP" required          
criterion "ConceptPlayerCapturedIntelligence" "Concept" "TLK_FLAGCAPTURED" required          


// Expressions
criterion "ConceptPlayerExpression" "Concept" "TLK_PLAYER_EXPRESSION" required


criterion "ConceptPlayerLostPoint" "Concept" "TLK_LOST_CONTROL_POINT'" required


criterion "IsSentryGun" "objtype" "sentrygun" required
criterion "IsTeleporterEntrance" "objtype" "teleporter_entrance" required
criterion "IsTeleporterExit" "objtype" "teleporter_exit" required
criterion "IsDispenser" "objtype" "dispenser" required
criterion "IsDisguised" "disguised" "1" required
criterion "IsWeaponPrimary" "weaponmode" "primary" required
criterion "IsWeaponSecondary" "weaponmode" "secondary" required
criterion "IsWeaponMelee" "weaponmode" "melee" required
criterion "IsWeaponBuilding" "weaponmode" "building" required
criterion "IsWeaponPda" "weaponmode" "pda" required


criterion "IsOnScout" "crosshair_on" "Scout" "required"
criterion "IsOnSniper" "crosshair_on" "Sniper" "required"
criterion "IsOnSoldier" "crosshair_on" "Soldier" "required"
criterion "IsOnDemoman" "crosshair_on" "Demoman" "required"
criterion "IsOnMedic" "crosshair_on" "Medic" "required"
criterion "IsOnHeavy" "crosshair_on" "Heavy" "required"
criterion "IsOnPyro" "crosshair_on" "Pyro" "required"
criterion "IsOnSpy" "crosshair_on" "Spy" "required"
criterion "IsOnEngineer" "crosshair_on" "Engineer" "required"

criterion "IsDominated" "domination" "dominated" "required" 
criterion "IsRevenge" "domination" "revenge" "required" 
criterion "IsHeadShot" "customdeath" "headshot" "required" 


criterion "ConceptKilledPlayer" "Concept" "TLK_KILLED_PLAYER" required
criterion "KilledPlayerDelay" "worldDontKilledPlayer" "!=1" "required"

criterion "IsScout" "playerclass" "Scout" "required" 
criterion "IsSniper" "playerclass" "Sniper" "required"
criterion "IsSoldier" "playerclass" "Soldier" "required"
criterion "IsDemoman" "playerclass" "Demoman" "required"
criterion "IsMedic" "playerclass" "Medic" "required"
criterion "IsHeavy" "playerclass" "Heavy" "required"
criterion "IsPyro" "playerclass" "Pyro" "required"
criterion "IsSpy" "playerclass" "Spy" "required"
criterion "IsEngineer" "playerclass" "Engineer" "required"

criterion "IsNotScout" "playerclass" "!=Scout" "required" 
criterion "IsNotSniper" "playerclass" "!=Sniper" "required"
criterion "IsNotSoldier" "playerclass" "!=Soldier" "required"
criterion "IsNotDemoman" "playerclass" "!=Demoman" "required"
criterion "IsNotMedic" "playerclass" "!=Medic" "required"
criterion "IsNotHeavy" "playerclass" "!=Heavy" "required"
criterion "IsNotPyro" "playerclass" "!=Pyro" "required"
criterion "IsNotSpy" "playerclass" "!=Spy" "required"
criterion "IsNotEngineer" "playerclass" "!=Engineer" "required"


criterion "IsVictimScout" "victimclass" "Scout" "required" weight 0
criterion "IsVictimSniper" "victimclass" "Sniper" "required" weight 0
criterion "IsVictimSoldier" "victimclass" "Soldier" "required" weight 0
criterion "IsVictimDemoman" "victimclass" "Demoman" "required" weight 0
criterion "IsVictimMedic" "victimclass" "Medic" "required" weight 0
criterion "IsVictimHeavy" "victimclass" "Heavy" "required" weight 0
criterion "IsVictimPyro" "victimclass" "Pyro" "required" weight 0
criterion "IsVictimSpy" "victimclass" "Spy" "required" weight 0
criterion "IsVictimEngineer" "victimclass" "Engineer" "required"  weight 0

criterion "IsNotVictimScout" "victimclass" "!=Scout" "required" weight 0
criterion "IsNotVictimSniper" "victimclass" "!=Sniper" "required" weight 0
criterion "IsNotVictimSoldier" "victimclass" "!=Soldier" "required" weight 0
criterion "IsNotVictimDemoman" "victimclass" "!=Demoman" "required" weight 0
criterion "IsNotVictimMedic" "victimclass" "!=Medic" "required" weight 0
criterion "IsNotVictimHeavy" "victimclass" "!=Heavy" "required" weight 0
criterion "IsNotVictimPyro" "victimclass" "!=Pyro" "required" weight 0
criterion "IsNotVictimSpy" "victimclass" "!=Spy" "required" weight 0
criterion "IsNotVictimEngineer" "victimclass" "!=Engineer" "required" weight 0
    


criterion "10PercentChance"  "randomnum"               ">90"   required
criterion "20PercentChance"  "randomnum"               ">80"   required
criterion "30PercentChance"  "randomnum"               ">70"   required
criterion "50PercentChance"  "randomnum"               ">50"   required
criterion "75PercentChance"  "randomnum"               ">25"   required
criterion "IsARecentKill"  "recentkills"               ">0"   required
criterion "IsManyRecentKills"  "recentkills"               ">1"   required
criterion "IsVeryManyRecentKills"  "recentkills"               ">3"   required
criterion "IsInvulnerable"  "invulnerable"               "1"   required weight 10

criterion "IsOnFriendlyControlPoint"  "OnFriendlyControlPoint"	"1"   required
criterion "IsOnCappableControlPoint"  "OnCappableControlPoint"	"1"   required

criterion "WeaponIsMinigun" "playerweapon" "tf_weapon_minigun" "required"
criterion "WeaponIsShotgun" "playerweapon" "tf_weapon_shotgun_secondary" "required"
criterion "WeaponIsShotgunSoldier" "playerweapon" "tf_weapon_shotgun_soldier" "required"
criterion "WeaponIsShotgunHwg" "playerweapon" "tf_weapon_shotgun_hwg" "required"
criterion "WeaponIsShotgunPyro" "playerweapon" "tf_weapon_shotgun_pyro" "required"



criterion "WeaponIsFists" "playerweapon" "tf_weapon_fists" "required"
criterion "WeaponIsFlamethrower" "playerweapon" "tf_weapon_flamethrower" "required"
criterion "WeaponIsAxe" "playerweapon" "tf_weapon_fireaxe" "required"
criterion "WeaponIsSyringe" "playerweapon" "tf_weapon_syringegun_medic" "required"
criterion "WeaponIsHeal" "playerweapon" "tf_weapon_medigun" "required"
criterion "WeaponIsBonesaw" "playerweapon" "tf_weapon_bonesaw" "required"
criterion "WeaponIsShotgunPrimary" "playerweapon" "tf_weapon_shotgun_primary" "required"
criterion "WeaponIsPistol" "playerweapon" "tf_weapon_pistol" "required"
criterion "WeaponIsBuild" "playerweapon" "tf_weapon_builder" "required"
criterion "WeaponIsWrench" "playerweapon" "tf_weapon_wrench" "required"
criterion "WeaponIsScattergun" "playerweapon" "tf_weapon_scattergun" "required"
criterion "WeaponIsPistolScout" "playerweapon" "tf_weapon_pistol_scout" "required"
criterion "WeaponIsBat" "playerweapon" "tf_weapon_bat" "required"
criterion "WeaponIsSniperrifle" "playerweapon" "tf_weapon_sniperrifle" "required"
criterion "WeaponIsSMG" "playerweapon" "tf_weapon_smg" "required"
criterion "WeaponIsClub" "playerweapon" "tf_weapon_club" "required"
criterion "WeaponIsRevolver" "playerweapon" "tf_weapon_revolver" "required"
criterion "WeaponIsKnife" "playerweapon" "tf_weapon_knife" "required"
criterion "WeaponIsPipebomb" "playerweapon" "tf_weapon_pipebomblauncher" "required"
criterion "WeaponIsGrenade" "playerweapon" "tf_weapon_grenadelauncher" "required"
criterion "WeaponIsBottle" "playerweapon" "tf_weapon_bottle" "required"
criterion "WeaponIsSpyPDA" "playerweapon" "tf_weapon_pda_spy" "required"
criterion "WeaponIsRocket" "playerweapon" "tf_weapon_rocketlauncher" "required"
criterion "WeaponIsShovel" "playerweapon" "tf_weapon_shovel" "required"

criterion "WeaponIsSentrygun" "customdeath" "sentrygun" "required"
criterion "WeaponIsNotSentrygun" "customdeath" "" "required"


criterion "DeployedContext" "sniperzoomed" "1" "required"
criterion "ConceptFireWeapon" "Concept" "TLK_FIREWEAPON" required
criterion "ConceptFireMinigun" "Concept" "TLK_FIREMINIGUN" required
criterion "ConceptWindMinigun" "Concept" "TLK_WINDMINIGUN" required
criterion "LowHealthContext" "playerhealthfrac" "<0.25" required
criterion "SuperHighHealthContext" "playerhealthfrac" ">1.400" required

criterion "IsFiringMinigun" "minigunfiretime" ">0.0" required
criterion "TimeFiringMinigunShort" "minigunfiretime" ">4.0,<=8.0" required
criterion "TimeFiringMinigunLong" "minigunfiretime" ">8.0,<=15.0" required
criterion "TimeFiringMinigunReallyLong" "minigunfiretime" ">15.0" required
criterion "ConceptFireMinigunTalk" "Concept" "TLK_MINIGUN_FIREWEAPON" "required"

// Test rules
#include "talker/tf.txt"
#include "talker/Heavy.txt"
#include "talker/Scout.txt"
#include "talker/Engineer.txt"
#include "talker/Sniper.txt"
#include "talker/Soldier.txt"
#include "talker/Demoman.txt"
#include "talker/Medic.txt"
#include "talker/Pyro.txt"
#include "talker/Spy.txt"
#include "talker/response_rules_hl2.txt"
